<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Bus Sim (Prototype)</title>

    <style>
        html, body {
            height: 100%;
            margin: 0;
            overflow: hidden;
            background: #0b0f14;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        }

        /* Canvas always full screen (3D scenes) */
        #game-canvas {
            position: fixed;
            inset: 0;
            width: 100%;
            height: 100%;
            display: block;
            z-index: 1;
        }

        /* UI layers sit on top */
        .ui-layer {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            z-index: 2;
        }

        .hidden { display: none !important; }

        /* ===== Splash background ===== */
        body.splash-bg {
            background: #0b0f14 url('./assets/main.png') center/cover no-repeat fixed;
        }

        /* Darken + add readability overlay on top of the background image */
        body.splash-bg::before {
            content: "";
            position: fixed;
            inset: 0;
            z-index: 0;
            pointer-events: none;

            /* very light overlay (almost transparent) */
            background:
                    radial-gradient(ellipse at 50% 35%,
                    rgba(0,0,0,0.00) 0%,
                    rgba(0,0,0,0.06) 65%,
                    rgba(0,0,0,0.10) 100%),
                    linear-gradient(180deg,
                    rgba(0,0,0,0.03) 0%,
                    rgba(0,0,0,0.08) 100%);
        }


        /* Hide the 3D canvas visually during splash so the background image is clean */
        body.splash-bg #game-canvas {
            opacity: 0;
            transition: opacity 200ms ease;
        }

        /* ===== Splash content ===== */
        .splash-wrap {
            pointer-events: auto;
            text-align: center;
            padding: 44px 28px 34px;
            border-radius: 22px;
            border: 1px solid rgba(255,255,255,0.12);
            background: rgba(8, 12, 18, 0.35);
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 80px rgba(0,0,0,0.45);
            max-width: 820px;
            width: min(820px, calc(100vw - 36px));
        }

        .splash-title {
            margin: 0;
            font-weight: 900;
            letter-spacing: 0.10em;
            text-transform: uppercase;
            font-size: clamp(44px, 6vw, 92px);
            line-height: 1.0;
            color: #ffffff;
            text-shadow:
                    0 2px 0 rgba(0,0,0,0.35),
                    0 0 22px rgba(255, 204, 0, 0.22),
                    0 0 42px rgba(126, 203, 255, 0.14);
        }

        .splash-subtitle {
            margin: 14px 0 26px;
            font-size: clamp(14px, 1.6vw, 18px);
            opacity: 0.85;
            color: rgba(255,255,255,0.92);
        }

        .start-btn {
            cursor: pointer;
            border: 1px solid rgba(255, 204, 0, 0.75);
            border-radius: 999px;
            padding: 14px 28px;
            font-size: 16px;
            font-weight: 900;
            letter-spacing: 0.14em;
            text-transform: uppercase;
            color: #0b0f14;
            background: linear-gradient(180deg, #ffdd33 0%, #ffb800 100%);
            position: relative;
            outline: none;
            transform: translateY(0);
            box-shadow:
                    0 10px 30px rgba(0,0,0,0.35),
                    0 0 18px rgba(255,204,0,0.28),
                    0 0 44px rgba(255,204,0,0.18);
            animation: pulseGlow 1.6s ease-in-out infinite;
        }

        .start-btn::after {
            content: "";
            position: absolute;
            inset: -10px;
            border-radius: 999px;
            border: 1px solid rgba(255, 204, 0, 0.38);
            opacity: 0.65;
            filter: blur(0.3px);
        }

        .start-btn:hover {
            filter: brightness(1.05);
        }

        .start-btn:active {
            transform: translateY(1px);
        }

        @keyframes pulseGlow {
            0%, 100% {
                box-shadow:
                        0 10px 30px rgba(0,0,0,0.35),
                        0 0 18px rgba(255,204,0,0.28),
                        0 0 44px rgba(255,204,0,0.18);
            }
            50% {
                box-shadow:
                        0 14px 40px rgba(0,0,0,0.42),
                        0 0 26px rgba(255,204,0,0.55),
                        0 0 78px rgba(255,204,0,0.28);
            }
        }

        .hint {
            margin-top: 14px;
            font-size: 12px;
            color: rgba(255,255,255,0.72);
        }

        /* ===== Bus selection HUD ===== */
        .topbar {
            position: fixed;
            left: 0;
            right: 0;
            top: 0;
            padding: 12px 14px;
            display: flex;
            justify-content: center;
            pointer-events: none;
            z-index: 2;
        }
        .topbar .chip {
            pointer-events: none;
            padding: 8px 12px;
            border-radius: 999px;
            border: 1px solid rgba(255,255,255,0.12);
            background: rgba(10,14,20,0.6);
            color: #fff;
            font-size: 13px;
            opacity: 0.92;
        }

        /* Blink effect */
        #blink {
            position: fixed;
            inset: 0;
            background: #fff;
            opacity: 0;
            pointer-events: none;
            z-index: 5;
        }
        #blink.blink { animation: blink 0.45s linear 1; }
        @keyframes blink {
            0% { opacity: 0; }
            12% { opacity: 1; }
            24% { opacity: 0; }
            36% { opacity: 1; }
            48% { opacity: 0; }
            100% { opacity: 0; }
        }
    </style>
</head>

<body>
<canvas id="game-canvas"></canvas>

<!-- Welcome screen -->
<div id="ui-welcome" class="ui-layer">
    <div class="splash-wrap">
        <h1 class="splash-title">SIMULATION BUS</h1>
        <div class="splash-subtitle">Drive the city. Master the routes. Build your fleet.</div>
        <button id="btn-start" class="start-btn" autofocus>Press Start</button>
        <div class="hint">Enter / Space</div>
    </div>
</div>

<!-- Bus selection HUD -->
<div id="ui-select" class="ui-layer hidden">
    <div class="topbar">
        <div class="chip">Pick your bus</div>
    </div>
</div>

<div id="blink"></div>

<!-- Import map (so browser can resolve "three") -->
<script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
        "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/",
        "three/examples/jsm/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
      }
    }
</script>

<script type="module" src="./src/main.js"></script>

<!-- Automated tests (runs on page load, check console for results) -->
<script type="module" src="./tests/core.test.js"></script>
</body>
</html>
