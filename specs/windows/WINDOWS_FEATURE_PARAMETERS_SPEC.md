# Windows — Feature Parameters Spec

Status: **Proposed (draft)**  
Scope: Window Builder feature tabs (**Frame, Muntins, Shade, Glass, Sill, Header/Lintel, Trim, Wear, Interior**) and any global tabs that compose those controls.  
Non-goals: Final shader authoring, detailed mesh topology, balcony details (deferred).

This spec defines feature-specific parameters that are not covered by:
- Sizes/positioning: `specs/windows/WINDOWS_SIZE_AND_POSITIONING_SPEC.md`
- Materials/finish (including per-face materials and lintel curved UV mapping option): `specs/windows/WINDOWS_MATERIALS_AND_FINISH_SPEC.md`

---

## 1. Feature Enablement (canonical keys)

The window system MUST support enable toggles for each feature tab:
- `frameEnabled`
- `muntinsEnabled`
- `shadeEnabled`
- `glassEnabled`
- `sillEnabled`
- `balconyEnabled` (behavior beyond enablement is deferred)
- `lintelEnabled`
- `trimEnabled`
- `wearEnabled`
- `interiorEnabled`

Rules:
- Disabling a feature MUST keep its configuration values (do not delete/reset).
- If a feature is disabled, its parameters MUST NOT affect output geometry/materials.

---

## 2. Ownership Clarification (window-system generated)

The following features are generated by the **window system** (attached to the window plane) for this project:
- Sill
- Header/Lintel
- Trim

Their size/position/material parameters are defined in the related specs (see top).

Balcony is deferred for deeper discussion and is not fully specified here.
Balcony is specified in: `specs/windows/WINDOWS_BALCONY_SPEC.md`

---

## 3. Frame (non-size/non-material behavior)

Frame sizing/arch/depth are defined in `specs/windows/WINDOWS_SIZE_AND_POSITIONING_SPEC.md`.

Frame materials + bevel/roundness “finish” are defined in `specs/windows/WINDOWS_MATERIALS_AND_FINISH_SPEC.md` and MUST be present in the first pass (Frame tab and Materials/Finish tab reuse the same control section).

---

## 4. Muntins (feature behavior)

Muntin layout and dimensions are defined in `specs/windows/WINDOWS_SIZE_AND_POSITIONING_SPEC.md`.

Finish rule:
- Muntins MUST inherit the frame bevel/roundness settings in first pass (no separate muntin bevel controls).

---

## 5. Shade

The Shade feature represents an interior-facing shade plane behind the glass.

### 5.1 Coverage (discrete)

Shade coverage MUST be discrete (first pass).

Parameters:
- `shadeCoverage` (number), allowed set: `{ 0.0, 0.2, 0.5, 1.0 }`

Interpretation:
- `0.0` = fully retracted
- `0.2` = slightly drawn
- `0.5` = half covering
- `1.0` = fully closed

### 5.2 Direction

Parameters:
- `shadeDirection` (enum):
  - `top_to_bottom`
  - `bottom_to_top`
  - `left_to_right`
  - `right_to_left`

### 5.3 Randomization (optional, deterministic)

If randomization is enabled, it MUST be deterministic per-window instance (stable across rebuilds when seed is unchanged).

Parameters (first pass):
- `shadeCoverageMode` (enum): `fixed | random`
- `shadeSeed` (int, optional): if not provided, a deterministic instance seed may be used
- `shadeRandomCoverageWeights` (map coverageValue -> weight, optional)

Rules:
- When `shadeCoverageMode = fixed`, use `shadeCoverage`.
- When `shadeCoverageMode = random`, select from the allowed coverage set using weights if provided; otherwise use an implementation-defined default distribution.

---

## 6. Glass

Glass is a transparent plane at the opening. It MUST NOT cast or receive shadows.

### 6.1 Presets (IOR/reflectivity)

IOR/reflectivity controls MUST be exposed as **presets** (first pass), not as raw numeric sliders.

Parameters:
- `glassPresetId` (string or enum)

Glass presets SHOULD include (implementation-defined, but must be consistent):
- reflectivity / specular strength
- IOR (index of refraction)
- roughness baseline

Note: It is currently known that changing IOR/reflectivity may not visibly change output; implementation MUST make presets visually meaningful.

### 6.2 Tint/opacity (first pass)

Tint/opacity may remain direct controls (not presets) to support art direction.

Parameters (first pass):
- `glassTint` (RGB)
- `glassOpacity` (0..1)

---

## 7. Interior (Parallax)

Interior uses a parallax interior catalog (preset-driven) so the atlas and tuning parameters are owned by the selected preset rather than by ad-hoc UI knobs.

Parameters (first pass):
- `parallaxInteriorPresetId` (string): selects a preset from the parallax interior catalog
- `interiorSeed` (int, optional): stable variation for the selected preset

Rules:
- No day/night controls in first pass.
- The interior preset controls depth/zoom and atlas selection; the window UI primarily selects the preset.

---

## 8. Wear (texture-mask driven, first pass)

Wear is a feature that applies grime/dirt/leaks to window elements, driven by **mask textures** and/or simple analytic masks (e.g., edge gradients).

Goal:
- Provide believable wear cues such as:
  - gradients on borders
  - water leak streaks on edges/ledges

### 8.1 Wear preset model

Parameters:
- `wearPresetId` (string): selects a wear preset definition (mask textures + default tunings)
- `wearIntensity` (0..1)
- `wearSeed` (int, optional): stable variation

Each preset MAY define where it applies (frame/muntins/sill/lintel/trim) and which wear layers it uses.

### 8.2 Wear layers (proposal)

This is a proposal for the first preset set; exact naming can change.

Layer types:
1) `edgeGradient` (border grime)
   - Mask source: analytic edge distance (UV-space or geometry-space)
   - Parameters (proposal):
     - `wearEdgeWidth` (meters or normalized): width of the border band
     - `wearEdgeSoftness` (0..1)
     - `wearEdgeStrength` (0..1)
2) `topLeaks` (water streaks)
   - Mask source: texture mask + noise, biased from top edges
   - Parameters (proposal):
     - `wearLeakStrength` (0..1)
     - `wearLeakLength` (0..1, relative)
     - `wearLeakDensity` (0..1)
     - `wearLeakDirection` (enum): `down` (first pass)
3) `bottomDust` (optional)
   - Mask source: gradient from bottom edge
   - Parameters (proposal):
     - `wearDustStrength` (0..1)

### 8.3 Application channels (proposal)

Wear may affect:
- base color (darkening / staining)
- roughness (wet streaks = smoother)
- normal intensity (subtle breakup)

Exact shader/material implementation is deferred, but presets and controls MUST be designed so the effect is visible and art-directable.
